---
- name: Ensure old versions of Docker are not installed.
  package:
    name:
      - docker
      - docker-common
      - docker-engine
    state: absent

- name: "Installing Docker Prerequisite packages"
  yum:
    name: "{{ item }}"
    state: latest
  with_items:
     - yum-utils
     - device-mapper-persistent-data
     - lvm2
     - unzip
     - git
     - python

- name: "Configuring docker-ce repo"
  get_url:
      url: https://download.docker.com/linux/centos/docker-ce.repo
      dest: /etc/yum.repos.d/docker-ce.repo
      mode: 0644

- name: " Installing Docker latest version"
  yum:
    name: docker-ce
    state: present

- name: Add jenkins user to docker group
  user:
    name: jenkins
    groups: docker
    append: yes
  become: yes

- name: " Starting and Enabling Docker service"
  service:
    name: docker
    state: started
    enabled: yes
    daemon_reload: yes

- name: install pip
  become: yes
  command: 'python get-pip.py'

- name: install docker-compose
  pip:
    name: docker-compose
    state: present